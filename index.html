<!DOCTYPE html><html lang="ja"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ブレインロットゲーム</title><style>body{margin:0;padding:0;background-color:#333;display:flex;justify-content:center;align-items:center;height:100vh;overflow:hidden;font-family:'Helvetica Neue',Arial,sans-serif;touch-action:none}#game-container{position:relative;width:100%;max-width:500px;height:90%;max-height:800px;background-color:#fceeb5;border-radius:8px;box-shadow:0 0 20px rgba(0,0,0,.5)}canvas{display:block;width:100%;height:100%;border-radius:8px}.ui-layer{position:absolute;top:10px;left:10px;pointer-events:none;color:#5d4037;font-weight:bold}.score-box{background:rgba(255,255,255,.8);padding:5px 10px;border-radius:15px;margin-bottom:5px;font-size:18px}#game-over,#loading{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);color:#fff;justify-content:center;align-items:center;flex-direction:column;z-index:10;border-radius:8px}#loading{display:flex;background:#fceeb5;color:#333}button{padding:15px 30px;font-size:20px;cursor:pointer;background:#ff9800;border:none;color:#fff;border-radius:50px;font-weight:bold}</style><div id="game-container"><div class="ui-layer"><div class="score-box">スコア: <span id="current-score">0</span></div><div class="score-box">ベスト: <span id="best-score">0</span></div></div><div id="loading"><h2>LOADING...</h2><p>画像を読み込んでいます</div><div id="game-over"><h2>GAME OVER!</h2><button onclick="location.reload()">リトライ</button></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script><script>function preloadImages(){const n=FRUITS_CONFIG.map((n,t)=>new Promise(i=>{const r=new Image;r.src=n.img;r.onload=()=>{loadedImages[t]=r,i()};r.onerror=()=>{console.warn(`Failed to load: ${n.img}`),loadedImages[t]=null,i()}}));return Promise.all(n)}function initGame(){bestScoreEl.innerText=bestScore;engine=Engine.create();engine.enableSleeping=!1;render=Render.create({element:container,engine:engine,options:{width:container.clientWidth,height:container.clientHeight,wireframes:!1,background:"#fceeb5",pixelRatio:window.devicePixelRatio}});const n={isStatic:!0,render:{fillStyle:"#8d6e63"},friction:.3},t=Bodies.rectangle(container.clientWidth/2,container.clientHeight+30,container.clientWidth,60,n),i=Bodies.rectangle(-30,container.clientHeight/2,60,container.clientHeight*2,n),r=Bodies.rectangle(container.clientWidth+30,container.clientHeight/2,60,container.clientHeight*2,n);Composite.add(engine.world,[t,i,r]);runner=Runner.create();Runner.run(runner,engine);Render.run(render);createNewCurrentFruit();setupEvents()}function createNewCurrentFruit(){const n=Math.floor(Math.random()*4);currentFruit.index=n;currentFruit.x=container.clientWidth/2}function addFruitToWorld(n,t,i){const r=FRUITS_CONFIG[i],f=loadedImages[i];let u={};if(f){const n=r.radius*2.1/f.width;u={sprite:{texture:r.img,xScale:n,yScale:n}}}else u={fillStyle:"#E91E63"};const e=Bodies.circle(n,t,r.radius,{label:"fruit",fruitIndex:i,restitution:.2,friction:.1,density:.002,render:u});Composite.add(engine.world,e)}function setupEvents(){Events.on(engine,"collisionStart",n=>{const t=n.pairs;for(let n=0;n<t.length;n++){const i=t[n].bodyA,r=t[n].bodyB;i.label==="fruit"&&r.label==="fruit"&&i.fruitIndex===r.fruitIndex&&(i.isRemoved||r.isRemoved||handleMerge(i,r))}});Events.on(render,"afterRender",()=>{const n=render.context;if(n.beginPath(),n.moveTo(0,DEADLINE_Y),n.lineTo(container.clientWidth,DEADLINE_Y),n.strokeStyle="rgba(255, 0, 0, 0.5)",n.lineWidth=2,n.setLineDash([10,10]),n.stroke(),n.setLineDash([]),!isGameOver){if(canDrop){const t=FRUITS_CONFIG[currentFruit.index],i=loadedImages[currentFruit.index];if(n.globalAlpha=1,i){const r=t.radius*2;n.drawImage(i,currentFruit.x-t.radius,currentFruit.y-t.radius,r,r)}else n.beginPath(),n.arc(currentFruit.x,currentFruit.y,t.radius,0,2*Math.PI),n.fillStyle="red",n.fill();n.beginPath();n.moveTo(currentFruit.x,currentFruit.y+t.radius);n.lineTo(currentFruit.x,container.clientHeight);n.strokeStyle="rgba(255, 255, 255, 0.5)";n.lineWidth=1;n.stroke();n.globalAlpha=1}checkGameOver()}});container.addEventListener("mousemove",handleMove);container.addEventListener("mouseup",handleRelease);container.addEventListener("touchmove",handleMove,{passive:!1});container.addEventListener("touchend",handleRelease,{passive:!1});window.addEventListener("resize",()=>{render.canvas.width=container.clientWidth,render.canvas.height=container.clientHeight})}function handleMerge(n,t){n.isRemoved=!0;t.isRemoved=!0;const i=n.fruitIndex;if(i>=FRUITS_CONFIG.length-1){Composite.remove(engine.world,[n,t]);addScore(FRUITS_CONFIG[i].score*2);return}const r=(n.position.x+t.position.x)/2,u=(n.position.y+t.position.y)/2;Composite.remove(engine.world,[n,t]);addFruitToWorld(r,u,i+1);addScore(FRUITS_CONFIG[i+1].score)}function addScore(n){isGameOver||(currentScore+=n,scoreEl.innerText=currentScore,currentScore>bestScore&&(bestScore=currentScore,bestScoreEl.innerText=bestScore,localStorage.setItem("suika_best_score",bestScore)))}function checkGameOver(){const t=Composite.allBodies(engine.world);let n=!1;for(let t of t)if(t.label==="fruit"&&!t.isStatic&&t.position.y-t.circleRadius*.5<DEADLINE_Y&&t.speed<.2){n=!0;break}n?(gameOverTimer++,gameOverTimer>60&&triggerGameOver()):gameOverTimer=0}function triggerGameOver(){isGameOver=!0;gameOverScreen.style.display="flex";Runner.stop(runner)}function getX(n){const u=container.getBoundingClientRect();let r=n.clientX;n.touches&&n.touches.length>0?r=n.touches[0].clientX:n.changedTouches&&n.changedTouches.length>0&&(r=n.changedTouches[0].clientX);let t=r-u.left;const i=FRUITS_CONFIG[currentFruit.index].radius;return t<i&&(t=i),t>container.clientWidth-i&&(t=container.clientWidth-i),t}function handleMove(n){!isGameOver&&canDrop&&(n.preventDefault(),currentFruit.x=getX(n))}function handleRelease(n){!isGameOver&&canDrop&&(n.preventDefault(),currentFruit.x=getX(n),canDrop=!1,addFruitToWorld(currentFruit.x,currentFruit.y,currentFruit.index),setTimeout(()=>{createNewCurrentFruit(),canDrop=!0},800))}const FRUITS_CONFIG=[{name:"1",radius:41,score:0,img:"./images/010.png"},{name:"2",radius:43,score:2,img:"./images/020.png"},{name:"3",radius:46,score:4,img:"./images/030.png"},{name:"4",radius:48,score:8,img:"./images/040.png"},{name:"5",radius:50,score:16,img:"./images/050.png"},{name:"6",radius:60,score:32,img:"./images/060.png"},{name:"7",radius:70,score:64,img:"./images/070.png"},{name:"8",radius:80,score:128,img:"./images/080.png"},{name:"9",radius:90,score:256,img:"./images/090.png"},{name:"10",radius:100,score:512,img:"./images/0110.png"},{name:"11",radius:125,score:1024,img:"./images/0120.png"}],DEADLINE_Y=100,Engine=Matter.Engine,Render=Matter.Render,Runner=Matter.Runner,Bodies=Matter.Bodies,Composite=Matter.Composite,Events=Matter.Events,Body=Matter.Body;let engine,render,runner,currentScore=0,bestScore=localStorage.getItem("suika_best_score")||0,isGameOver=!1,canDrop=!0;const loadedImages=[];let currentFruit={x:0,y:50,index:0};const container=document.getElementById("game-container"),scoreEl=document.getElementById("current-score"),bestScoreEl=document.getElementById("best-score"),gameOverScreen=document.getElementById("game-over"),loadingScreen=document.getElementById("loading");preloadImages().then(()=>{loadingScreen.style.display="none",initGame()}).catch(n=>{console.error("画像の読み込みに失敗しました",n),alert("画像の読み込みに失敗しました。")});let gameOverTimer=0</script>
